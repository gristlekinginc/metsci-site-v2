"use strict";(self.webpackChunkmeteoscientific=self.webpackChunkmeteoscientific||[]).push([[9339],{8453:(e,t,o)=>{o.d(t,{R:()=>r,x:()=>s});var a=o(6540);const n={},i=a.createContext(n);function r(e){const t=a.useContext(i);return a.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function s(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:r(e.components),a.createElement(i.Provider,{value:t},e.children)}},9936:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>d,contentTitle:()=>r,default:()=>c,frontMatter:()=>i,metadata:()=>s,toc:()=>l});var a=o(4848),n=o(8453);const i={title:"How Do You Keep Your Data?",authors:["nik"],tags:["lorawan","business","helium"],description:"How any business can hold on to the data their LoRaWAN sensor produce."},r=void 0,s={permalink:"/blog/2025/06/29/How-Do-You-Keep-Your-Data",source:"@site/blog/2025-06-29-How-Do-You-Keep-Your-Data.md",title:"How Do You Keep Your Data?",description:"How any business can hold on to the data their LoRaWAN sensor produce.",date:"2025-06-29T00:00:00.000Z",formattedDate:"June 29, 2025",tags:[{label:"lorawan",permalink:"/blog/tags/lorawan"},{label:"business",permalink:"/blog/tags/business"},{label:"helium",permalink:"/blog/tags/helium"}],readingTime:17.145,hasTruncateMarker:!0,authors:[{name:"Nik Hawks",title:"IoT Educator & Builder",url:"https://meteoscientific.com/",description:"Nik writes to educate and delight people considering IoT, and to inspire other IoT nerds to build and deploy their own projects into the world. He runs a podcast discussing all things LoRaWAN and is psyched to hear about what you're building, whether it's a one sensor playground or a million sensor rollout.",page:!0,socials:{x:"thegristleking",linkedin:"https://www.linkedin.com/in/nikhawks/",youtube:"https://www.youtube.com/@meteoscientific",website:"https://www.meteoscientific.com/"},imageURL:"/img/Nik_Hawks_profile_pic.jpeg",key:"nik"}],frontMatter:{title:"How Do You Keep Your Data?",authors:["nik"],tags:["lorawan","business","helium"],description:"How any business can hold on to the data their LoRaWAN sensor produce."},unlisted:!1,prevItem:{title:"Read This First",permalink:"/blog/welcome"},nextItem:{title:"Is One Sensor Enough?",permalink:"/blog/2025/06/22/Single-IoT-Sensor-Power-The-Sled"}},d={authorsImageUrls:[void 0]},l=[{value:"Set Up The Database",id:"set-up-the-database",level:2},{value:"Create A Table",id:"create-a-table",level:3},{value:"Set Up The Worker",id:"set-up-the-worker",level:2},{value:"Domain &amp; Routes",id:"domain--routes",level:3},{value:"Set Up Your Secret",id:"set-up-your-secret",level:3},{value:"Add Worker Code",id:"add-worker-code",level:3},{value:"Set Up The Integration in MetSci Console",id:"set-up-the-integration-in-metsci-console",level:2},{value:"Confirm Packets",id:"confirm-packets",level:2}];function h(e){const t={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",strong:"strong",...(0,n.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.p,{children:"If you're a business owner and psyched on LoRaWAN (or even just curious about it), one of the things you'll have to wrap your head around is how to store your data."}),"\n",(0,a.jsxs)(t.p,{children:["LoRaWAN devices are generally exceptional at ",(0,a.jsx)(t.strong,{children:"sending"})," data from one place to another, but if you want your data to be useful you have to both retain it and be able to integrate it into what you want."]}),"\n",(0,a.jsx)(t.p,{children:"Now, the economics of LoRaWAN can send you a bunch of different directions here. You could use a fully managed service to just set up all your devices, gateways, and data pipeline for you, but there are two problems with that approach:"}),"\n",(0,a.jsxs)(t.p,{children:["A) ",(0,a.jsx)(t.strong,{children:"Less fun"})," - Why let someone else learn all this rad stuff?"]}),"\n",(0,a.jsxs)(t.p,{children:["B) ",(0,a.jsx)(t.strong,{children:"More expensive"})," - You'll pay someone else to have all your fun.  That's silly."]}),"\n",(0,a.jsx)(t.p,{children:'That depends on your definition of "fun" and "expensive", but I\'ll assume for now that you\'re a small business owner who is a little geeky and curious, intrigued by the idea of free data storage at small sizes on a world-class platform, and you have an idea about how you\'d use an IoT sensor in your business.'}),"\n",(0,a.jsxs)(t.p,{children:["If that's NOT you, and you just want someone to handle all this for you, reach out to me via the ",(0,a.jsx)(t.a,{href:"/contact",children:"Contact"})," page and I'll put you in touch with someone who'll do the heavy lifting."]}),"\n",(0,a.jsx)(t.p,{children:"Ok, with all the caveats out of the way, let's briefly sketch out the data flow so you have the big concepts, then we'll go through a step by step tutorial for how to get a sensor to send data that you can keep."}),"\n",(0,a.jsxs)(t.p,{children:["It starts with the sensor sending data.  In this case we'll use an Oyster 2.1 asset tracker from Digital Matter.  Onboarding these to any LNS is straightforward (hell, there's even a ",(0,a.jsx)(t.code,{children:"Digital Matter Oyster 2.1"})," Device Template set up for all users of the ",(0,a.jsx)(t.a,{href:"https://console.meteoscientific.com",children:"MeteoScientific Console"})," that you can use for free)"]}),"\n",(0,a.jsx)("div",{style:{display:"flex",justifyContent:"center",margin:"20px auto"},children:(0,a.jsx)("img",{src:"/img/blog/2025-06-29-how-do-you-keep-your-data/device-profile-template.png",alt:"Device profile template for Oyster 2.1 asset tracker in MeteoScientific Console",style:{maxWidth:"800px",width:"100%",borderRadius:"8px",border:"4px solid var(--metsci-primary)",boxShadow:"0 4px 12px rgba(217, 74, 24, 0.15)"}})}),"\n",(0,a.jsxs)(t.p,{children:["With the data coming ",(0,a.jsx)(t.strong,{children:"in"})," to the LNS from the device, you\u2019ve got a VERY temporary storage set up, but it\u2019s only useful for testing."]}),"\n",(0,a.jsx)(t.p,{children:"I usually set up the Device Metrics in MeteoScientific just because I\u2019m a nerd and it\u2019s fun to do a quick check on what\u2019s come in, but it\u2019s NOT (by a long shot) a data storage mechanism that\u2019s useful."}),"\n",(0,a.jsx)("div",{style:{display:"flex",justifyContent:"center",margin:"20px auto"},children:(0,a.jsx)("img",{src:"/img/blog/2025-06-29-how-do-you-keep-your-data/device-metrics-testing.png",alt:"Device metrics testing interface showing battery voltage, GPS coordinates, and tracking data",style:{maxWidth:"800px",width:"100%",borderRadius:"8px",border:"4px solid var(--metsci-primary)",boxShadow:"0 4px 12px rgba(217, 74, 24, 0.15)"}})}),"\n",(0,a.jsx)(t.p,{children:"As you can see above, the tracker I\u2019ve set up for this demo has been moving occasionally, and when it does it transmits the data it\u2019s supposed to transmit (battery voltage, heading, latitude, etc.)."}),"\n",(0,a.jsx)(t.p,{children:"So, where do we send the data?  You\u2019ve got a TON of options here.  At the super low end of devices or volume most of them are free with restrictions ranging from the number of devices you can have to the length of time you can store the data."}),"\n",(0,a.jsxs)(t.p,{children:["Services like ",(0,a.jsx)(t.a,{href:"https://datacake.co/",children:"Datacake"})," or ",(0,a.jsx)(t.a,{href:"https://tago.io/",children:"TagoIO"})," offer free data storage and visualization of data for low device counts (5 or less) and short term data storage (30 days)."]}),"\n",(0,a.jsx)(t.p,{children:"What we\u2019re going to do today is slightly more geeky but gives you more data for longer."}),"\n",(0,a.jsx)(t.p,{children:"It IS less easy, make no mistake.  However, once you learn this you can use it for the rest of your business life, so there's that."}),"\n",(0,a.jsx)(t.p,{children:"We\u2019re going to send our data to a database on Cloudflare called a D1, and we\u2019re going to do that with a Cloudflare Worker."}),"\n",(0,a.jsx)(t.p,{children:"I get it, this might sound super scary and technical."}),"\n",(0,a.jsx)("div",{style:{display:"flex",justifyContent:"center",margin:"20px auto"},children:(0,a.jsx)("img",{src:"/img/blog/2025-06-29-how-do-you-keep-your-data/scary-data-center.png",alt:"Intimidating data center control room with multiple screens and complex equipment",style:{maxWidth:"800px",width:"100%",borderRadius:"8px",border:"4px solid var(--metsci-primary)",boxShadow:"0 4px 12px rgba(217, 74, 24, 0.15)"}})}),"\n",(0,a.jsx)(t.p,{children:"It\u2019s actually not that scary."}),"\n",(0,a.jsx)(t.p,{children:"Think of a database like a muscular Excel sheet and you\u2019ve got a good picture of what you\u2019re doing. The Worker is just the thing that takes your data from the LNS and puts it into the database."}),"\n",(0,a.jsx)(t.p,{children:"If you can visualize rows and columns, you\u2019re visualizing a database.  Yes, it can get way more complex, but we're not running an Amazon warehouse here, we're storing the data of a couple dozen things, starting with just one thing."}),"\n",(0,a.jsx)(t.p,{children:"The massive advantage of a Cloudflare D1 for what we\u2019re doing is that the free level is more than enough for most small business needs.  You can have up to 10 databases with each one having 500 MB of data."}),"\n",(0,a.jsxs)(t.p,{children:["As a ",(0,a.jsx)(t.strong,{children:"rough"})," stand-in for how much 500 MB will get you, it\u2019s about 4 million rows if you\u2019re tracking 10 \u201cshort\u201d things (id, name, latitude, longitude, speed, heading, battery voltage, rssi, and snr.)"]}),"\n",(0,a.jsx)(t.p,{children:"For a tracker sending every 5 minutes you can store 7+ years of data.(4,000,000 / 1440 minutes per day / 365 days in a year)."}),"\n",(0,a.jsx)(t.p,{children:"You get 10 of those databases on the free plan, and the first paid tier after that is $5/month."}),"\n",(0,a.jsx)(t.p,{children:"The \u201chidden\u201d cost is the geekery of setting it up, but I\u2019ll walk you through that now."}),"\n",(0,a.jsx)(t.p,{children:"I\u2019ll make three assumptions here."}),"\n",(0,a.jsxs)(t.p,{children:["First, I\u2019ll assume you have a ",(0,a.jsx)(t.a,{href:"https://www.cloudflare.com/?utm_source=meteoscientific&utm_medium=blog&utm_campaign=how-do-you-keep-your-data",children:"Cloudflare"})," account."]}),"\n",(0,a.jsx)(t.p,{children:"Second, I\u2019ll assume you have a domain that you manage via Cloudflare.  If you don't, it\u2019s about $11 a year to buy a domain on Cloudflare which you can then use for this project, so if you don\u2019t want to go through the trouble of taking your current domain and futzing around with getting it onto Cloudflare, just buy a new domain and use that."}),"\n",(0,a.jsxs)(t.p,{children:["Third, I\u2019ll assume you have a LoRaWAN device sending out data you want to track. In my case, it\u2019ll be an ",(0,a.jsx)(t.a,{href:"https://www.lonestartracking.com/tracking-devices/oyster3-4g-5g-waterproof-battery-powered-gps-tracking-device/?utm_source=meteoscientific&utm_medium=blog&utm_campaign=how-do-you-keep-your-data",children:"Oyster 2.1 tracker"})," that I\u2019ve got mounted on my bike."]}),"\n",(0,a.jsx)(t.p,{children:"I can use this to store all the places that my bike goes, and if I wanted to get nerdy, built a heat map of local LoRaWAN coverage, but that\u2019ll be for another tutorial."}),"\n",(0,a.jsx)("div",{style:{display:"flex",justifyContent:"center",margin:"20px auto"},children:(0,a.jsx)("img",{src:"/img/blog/2025-06-29-how-do-you-keep-your-data/oyster-on-bike.JPG",alt:"Oyster 2.1 asset tracker mounted on bicycle frame for location tracking",style:{maxWidth:"800px",width:"100%",borderRadius:"8px",border:"4px solid var(--metsci-primary)",boxShadow:"0 4px 12px rgba(217, 74, 24, 0.15)"}})}),"\n",(0,a.jsx)(t.h2,{id:"set-up-the-database",children:"Set Up The Database"}),"\n",(0,a.jsxs)(t.p,{children:["Let's do this!  Sign in to Cloudflare.  Once you\u2019re on the Cloudflare Account home, select ",(0,a.jsx)(t.strong,{children:"Storage & Databases"}),", then ",(0,a.jsx)(t.strong,{children:"D1 SQL Database"})," from the dropdown."]}),"\n",(0,a.jsx)("div",{style:{display:"flex",justifyContent:"center",margin:"20px auto"},children:(0,a.jsx)("img",{src:"/img/blog/2025-06-29-how-do-you-keep-your-data/cloudflare-storage-databases.png",alt:"Cloudflare dashboard showing Storage & Databases section with D1 SQL Database option",style:{maxWidth:"800px",width:"100%",borderRadius:"8px",border:"4px solid var(--metsci-primary)",boxShadow:"0 4px 12px rgba(217, 74, 24, 0.15)"}})}),"\n",(0,a.jsx)(t.p,{children:"Now you\u2019ll hit the big blue \u201c+ Create Database\u201d button at the top right and then follow the prompts."}),"\n",(0,a.jsx)("div",{style:{display:"flex",justifyContent:"center",margin:"20px auto"},children:(0,a.jsx)("img",{src:"/img/blog/2025-06-29-how-do-you-keep-your-data/create-database.png",alt:"Cloudflare D1 database creation interface showing the Create Database button",style:{maxWidth:"800px",width:"100%",borderRadius:"8px",border:"4px solid var(--metsci-primary)",boxShadow:"0 4px 12px rgba(217, 74, 24, 0.15)"}})}),"\n",(0,a.jsx)(t.p,{children:"Name it (I\u2019ll call mine metsci-bike-tracker), and leave the location as automatic."}),"\n",(0,a.jsx)("div",{style:{display:"flex",justifyContent:"center",margin:"20px auto"},children:(0,a.jsx)("img",{src:"/img/blog/2025-06-29-how-do-you-keep-your-data/name_D1.png",alt:"Database naming interface showing metsci-bike-tracker database name input",style:{maxWidth:"800px",width:"100%",borderRadius:"8px",border:"4px solid var(--metsci-primary)",boxShadow:"0 4px 12px rgba(217, 74, 24, 0.15)"}})}),"\n",(0,a.jsx)(t.h3,{id:"create-a-table",children:"Create A Table"}),"\n",(0,a.jsxs)(t.p,{children:["Next we\u2019ll create a table manually.  Click the blue \u201cCreate table\u201d button at the top right, then select the ",(0,a.jsx)(t.code,{children:"Console"})," tab in your new database and paste in the following command.  To copy, hit the little copy button in the top right of the field, otherwise you'll only get the first few words."]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{children:"CREATE TABLE oyster_tracks (   id              TEXT    PRIMARY KEY,   time            TIMESTAMP,   dev_eui         TEXT,   battery_voltage REAL,   fix_failed      BOOLEAN,   latitude        REAL,   longitude       REAL,   speed_kmph      REAL,   heading_deg     REAL,   rssi            INTEGER,   snr             REAL );\n"})}),"\n",(0,a.jsx)("div",{style:{display:"flex",justifyContent:"center",margin:"20px auto"},children:(0,a.jsx)("img",{src:"/img/blog/2025-06-29-how-do-you-keep-your-data/create-table-with-console-command.png",alt:"D1 database console showing CREATE TABLE command for oyster_tracks table",style:{maxWidth:"800px",width:"100%",borderRadius:"8px",border:"4px solid var(--metsci-primary)",boxShadow:"0 4px 12px rgba(217, 74, 24, 0.15)"}})}),"\n",(0,a.jsx)(t.p,{children:"If you\u2019re not using an Oyster,  modify your table to save whatever you\u2019d like from your device.  The absolute easiest way to get this table-create command is to use ChatGPT, telling it what you want and giving it a recent event log from your device."}),"\n",(0,a.jsx)(t.p,{children:"The prompt for this would be something like:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{children:'\nUsing the event log from my device, \nplease build me a "CREATE TABLE" SQL command \nfor a Cloudflare D1 table that stores the \nfollowing values: id, time, dev_eui, \nbattery_voltage, latitude, longitude, rssi, snr.\n\n'})}),"\n",(0,a.jsx)(t.p,{children:"Each LNS can be a bit different, but to get your Event log in the MeteoScientific LNS (which runs on a custom Chirpstack setup), go into Applications \u2014> your application \u2014> Devices \u2014> your device and select the Events tab, then Download."}),"\n",(0,a.jsx)("div",{style:{display:"flex",justifyContent:"center",margin:"20px auto"},children:(0,a.jsx)("img",{src:"/img/blog/2025-06-29-how-do-you-keep-your-data/get-event-log-json.png",alt:"MeteoScientific Console device events interface showing download option for multiple event logs",style:{maxWidth:"800px",width:"100%",borderRadius:"8px",border:"4px solid var(--metsci-primary)",boxShadow:"0 4px 12px rgba(217, 74, 24, 0.15)"}})}),"\n",(0,a.jsx)(t.p,{children:"Ok, now you\u2019ve got your database and a table setup, we\u2019ll need to create the connection between your LNS and the database.  We\u2019ll do this using an http integration to send from the LNS, and a Cloudflare Worker to receive the data and put it into the database."}),"\n",(0,a.jsx)(t.h2,{id:"set-up-the-worker",children:"Set Up The Worker"}),"\n",(0,a.jsxs)(t.p,{children:["In Cloudflare, start by creating a Worker.  Go to ",(0,a.jsx)(t.code,{children:"Compute (Workers)"})," on the left column, choose ",(0,a.jsx)(t.code,{children:"Workers & Pages"}),", then look for the ",(0,a.jsx)(t.code,{children:"Create"})," button"]}),"\n",(0,a.jsx)("div",{style:{display:"flex",justifyContent:"center",margin:"20px auto"},children:(0,a.jsx)("img",{src:"/img/blog/2025-06-29-how-do-you-keep-your-data/create-a-cloudflare-worker.png",alt:"Cloudflare Workers dashboard showing the Create button for new workers",style:{maxWidth:"800px",width:"100%",borderRadius:"8px",border:"4px solid var(--metsci-primary)",boxShadow:"0 4px 12px rgba(217, 74, 24, 0.15)"}})}),"\n",(0,a.jsxs)(t.p,{children:["Choose ",(0,a.jsx)(t.code,{children:"Workers"})," then ",(0,a.jsx)(t.code,{children:"Start with Hello World!"})," option:"]}),"\n",(0,a.jsx)("div",{style:{display:"flex",justifyContent:"center",margin:"20px auto"},children:(0,a.jsx)("img",{src:"/img/blog/2025-06-29-how-do-you-keep-your-data/worker-start-hello-world.png",alt:"Cloudflare Worker creation interface showing Hello World starter template option",style:{maxWidth:"800px",width:"100%",borderRadius:"8px",border:"4px solid var(--metsci-primary)",boxShadow:"0 4px 12px rgba(217, 74, 24, 0.15)"}})}),"\n",(0,a.jsxs)(t.p,{children:["Name your worker (I\u2019ll use the same name as my database, ",(0,a.jsx)(t.code,{children:"metsci-bike-tracker"}),") and hit Deploy in the bottom right.  You don\u2019t need to change the ",(0,a.jsx)(t.code,{children:"worker.js"})," code here (in fact, you can\u2019t, so don\u2019t even try)."]}),"\n",(0,a.jsx)("div",{style:{display:"flex",justifyContent:"center",margin:"20px auto"},children:(0,a.jsx)("img",{src:"/img/blog/2025-06-29-how-do-you-keep-your-data/name-and-deploy-worker.png",alt:"Worker naming interface showing metsci-bike-tracker worker name and Deploy button",style:{maxWidth:"800px",width:"100%",borderRadius:"8px",border:"4px solid var(--metsci-primary)",boxShadow:"0 4px 12px rgba(217, 74, 24, 0.15)"}})}),"\n",(0,a.jsx)(t.h3,{id:"domain--routes",children:"Domain & Routes"}),"\n",(0,a.jsx)(t.p,{children:"Now, as stated in the Assumptions, if you haven\u2019t set up a domain with Cloudflare, this next part won\u2019t work."}),"\n",(0,a.jsx)(t.p,{children:"We\u2019re going to set up three things here, a custom domain, a route, and a Cloudflare Secret."}),"\n",(0,a.jsxs)(t.p,{children:["Start with ",(0,a.jsx)(t.code,{children:"Add custom domain"})," which will take you to the ",(0,a.jsx)(t.code,{children:"Settings"})," tab in your fancy new Cloudflare Worker."]}),"\n",(0,a.jsx)("div",{style:{display:"flex",justifyContent:"center",margin:"20px auto"},children:(0,a.jsx)("img",{src:"/img/blog/2025-06-29-how-do-you-keep-your-data/domains-routes-secrets.png",alt:"Cloudflare Worker settings showing Domains & Routes and Variables & Secrets sections",style:{maxWidth:"800px",width:"100%",borderRadius:"8px",border:"4px solid var(--metsci-primary)",boxShadow:"0 4px 12px rgba(217, 74, 24, 0.15)"}})}),"\n",(0,a.jsxs)(t.p,{children:["In Domains & Routes at the top of the page, select the ",(0,a.jsx)(t.code,{children:"+ Add"})," button, then choose Custom Domain and enter your custom domain."]}),"\n",(0,a.jsxs)(t.p,{children:["In my case, because I manage meteoscientific.com through Cloudflare and this is a bike-tracker, I\u2019m going to use bike-tracker.meteoscientific.com as my domain.  You can use whatever you want.  Hit ",(0,a.jsx)(t.code,{children:"Add domain"})," at the bottom to save your selection."]}),"\n",(0,a.jsxs)(t.p,{children:["Next we\u2019ll set up a Route.  Use the same ",(0,a.jsx)(t.code,{children:"+ Add"})," button as before in the Domains & Routes section, except this time choose ",(0,a.jsx)(t.code,{children:"Route"}),", then choose your Zone (your domain url) and paste in a Route.  I\u2019m going to use ",(0,a.jsx)(t.code,{children:"bike-tracker.meteoscientific.com/api/track"})]}),"\n",(0,a.jsx)("div",{style:{display:"flex",justifyContent:"center",margin:"20px auto"},children:(0,a.jsx)("img",{src:"/img/blog/2025-06-29-how-do-you-keep-your-data/create-a-route-in-cloudflare-worker.png",alt:"Cloudflare Worker route creation interface showing custom route setup",style:{maxWidth:"800px",width:"100%",borderRadius:"8px",border:"4px solid var(--metsci-primary)",boxShadow:"0 4px 12px rgba(217, 74, 24, 0.15)"}})}),"\n",(0,a.jsx)(t.h3,{id:"set-up-your-secret",children:"Set Up Your Secret"}),"\n",(0,a.jsx)(t.p,{children:"So now your Worker knows where to listen for incoming data, which is cool.  We\u2019re going to secure it so that not every jackwagon on the internet can just willy nilly add data to your table.  We\u2019ll do that using a Cloudflare Secret."}),"\n",(0,a.jsxs)(t.p,{children:["Hit the ",(0,a.jsx)(t.code,{children:"+ Add"})," in the ",(0,a.jsx)(t.code,{children:"Variables and Secrets"})," section\nChoose ",(0,a.jsx)(t.code,{children:"Type \u2014> Secret"})," then enter in your Variable Name (I used ",(0,a.jsx)(t.code,{children:"TRACKER_AUTH_TOKEN"}),") and then a secret Value.  Save this value and don\u2019t share it with anyone.  Use numbers and letters, no symbols, and make it long."]}),"\n",(0,a.jsx)("div",{style:{display:"flex",justifyContent:"center",margin:"20px auto"},children:(0,a.jsx)("img",{src:"/img/blog/2025-06-29-how-do-you-keep-your-data/cloudflare-secret-setup.png",alt:"Cloudflare Worker secret setup showing TRACKER_AUTH_TOKEN variable configuration",style:{maxWidth:"800px",width:"100%",borderRadius:"8px",border:"4px solid var(--metsci-primary)",boxShadow:"0 4px 12px rgba(217, 74, 24, 0.15)"}})}),"\n",(0,a.jsx)(t.h3,{id:"add-worker-code",children:"Add Worker Code"}),"\n",(0,a.jsx)(t.p,{children:"Now you\u2019ll add the Worker code.  I\u2019ll give you mine for the Oyster, but if you\u2019re using a different device, yours will be different. Again, the easiest way to get a working Worker is to use ChatGPT.  Give it this as an example along with a full Event from your latest uplink and tell it what you want.  For now, we\u2019ll proceed with my example."}),"\n",(0,a.jsxs)(t.p,{children:["Choose the ",(0,a.jsx)(t.code,{children:"Edit Code"})," button at the top right."]}),"\n",(0,a.jsx)("div",{style:{display:"flex",justifyContent:"center",margin:"20px auto"},children:(0,a.jsx)("img",{src:"/img/blog/2025-06-29-how-do-you-keep-your-data/choose-edit-code-icon.png",alt:"Cloudflare Worker interface showing the Edit Code button",style:{maxWidth:"800px",width:"100%",borderRadius:"8px",border:"4px solid var(--metsci-primary)",boxShadow:"0 4px 12px rgba(217, 74, 24, 0.15)"}})}),"\n",(0,a.jsx)(t.p,{children:"Then in the worker.js space, paste in the following:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{children:'export default {\n  async fetch(request, env) {\n    // 1. Only POST + auth\n    if (request.method !== "POST") {\n      return new Response("Method Not Allowed", { status: 405 });\n    }\n    const auth = request.headers.get("Authorization");\n    if (auth !== `Bearer ${env.TRACKER_AUTH_TOKEN}`) {\n      return new Response("Unauthorized", { status: 401 });\n    }\n    \n    // 2. Parse JSON\n    if (!request.headers.get("Content-Type")?.includes("application/json")) {\n      return new Response("Unsupported Media Type", { status: 415 });\n    }\n    let body;\n    try {\n      body = await request.json();\n    } catch {\n      return new Response("Bad JSON", { status: 400 });\n    }\n\n    // 3. Extract fields\n    const id           = body.deduplicationId;\n    const time         = body.time;\n    const dev_eui      = body.deviceInfo?.devEui;\n    const batV         = body.object?.batV           ?? null;\n    const fixFailed    = body.object?.fixFailed       ?? false;\n    const latitude     = body.object?.latitudeDeg     ?? null;\n    const longitude    = body.object?.longitudeDeg    ?? null;\n    const speedKmph    = body.object?.speedKmph       ?? null;\n    const headingDeg   = body.object?.headingDeg      ?? null;\n\n    // 4. Take the reported RSSI/SNR (first rxInfo entry)\n    const firstRx      = Array.isArray(body.rxInfo) ? body.rxInfo[0] : null;\n    const rssi         = firstRx?.rssi  ?? null;\n    const snr          = firstRx?.snr   ?? null;\n\n    // 5. Insert into oyster_tracks\n    try {\n      await env.DB.prepare(`\n        INSERT INTO oyster_tracks (\n          id, time, dev_eui,\n          battery_voltage, fix_failed,\n          latitude, longitude,\n          speed_kmph, heading_deg,\n          rssi, snr\n        ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\n      `)\n      .bind(\n        id, time, dev_eui,\n        batV, fixFailed,\n        latitude, longitude,\n        speedKmph, headingDeg,\n        rssi, snr\n      )\n      .run();\n\n      return new Response("OK", { status: 200 });\n    } catch (err) {\n      return new Response(`DB error: ${err.message}`, { status: 500 });\n    }\n  }\n}\n\n\n'})}),"\n",(0,a.jsx)(t.p,{children:"It'll look like this:"}),"\n",(0,a.jsx)("div",{style:{display:"flex",justifyContent:"center",margin:"20px auto"},children:(0,a.jsx)("img",{src:"/img/blog/2025-06-29-how-do-you-keep-your-data/paste-in-worker-code.png",alt:"Cloudflare Worker code editor showing the JavaScript code for handling IoT data",style:{maxWidth:"800px",width:"100%",borderRadius:"8px",border:"4px solid var(--metsci-primary)",boxShadow:"0 4px 12px rgba(217, 74, 24, 0.15)"}})}),"\n",(0,a.jsxs)(t.p,{children:["Then hit the blue ",(0,a.jsx)(t.code,{children:"Deploy"})," at the top right."]}),"\n",(0,a.jsxs)(t.p,{children:["One last thing and we\u2019ll be done on the Cloudflare side.  In the top left, click the left arrow ",(0,a.jsx)(t.code,{children:"metsci-bike-tracker"})," or whatever you named your Worker."]}),"\n",(0,a.jsxs)(t.p,{children:["This will take you back to your Worker and the main menu.  Select the ",(0,a.jsx)(t.code,{children:"Bindings"})," tab, then the blue ",(0,a.jsx)(t.code,{children:"Add binding"})," button."]}),"\n",(0,a.jsx)("div",{style:{display:"flex",justifyContent:"center",margin:"20px auto"},children:(0,a.jsx)("img",{src:"/img/blog/2025-06-29-how-do-you-keep-your-data/add-binding.png",alt:"Cloudflare Worker bindings interface showing the Add binding button",style:{maxWidth:"800px",width:"100%",borderRadius:"8px",border:"4px solid var(--metsci-primary)",boxShadow:"0 4px 12px rgba(217, 74, 24, 0.15)"}})}),"\n",(0,a.jsxs)(t.p,{children:["Then choose D1 Database from the list of options, use ",(0,a.jsx)(t.code,{children:"DB"})," for the Variable name, and select your database, then save or deploy."]}),"\n",(0,a.jsx)("div",{style:{display:"flex",justifyContent:"center",margin:"20px auto"},children:(0,a.jsx)("img",{src:"/img/blog/2025-06-29-how-do-you-keep-your-data/select-and-name-database-to-bind.png",alt:"D1 database binding configuration showing DB variable name and database selection",style:{maxWidth:"800px",width:"100%",borderRadius:"8px",border:"4px solid var(--metsci-primary)",boxShadow:"0 4px 12px rgba(217, 74, 24, 0.15)"}})}),"\n",(0,a.jsx)(t.p,{children:"You\u2019ll see a new binding in the Connected Bindings section."}),"\n",(0,a.jsx)(t.h2,{id:"set-up-the-integration-in-metsci-console",children:"Set Up The Integration in MetSci Console"}),"\n",(0,a.jsx)(t.p,{children:"Cool!  The D1 database and the Worker are now set up and connected, ready to receive.  All we have to do now is set up the http integration side, check our work, and then let our database fill up with data."}),"\n",(0,a.jsxs)(t.p,{children:["I\u2019ll be using the ",(0,a.jsx)(t.a,{href:"https://console.meteoscientific.com/",children:"MeteoScientific Console"})," in this example, which makes it really easy to use the Helium network plus your first 400 data credits are free, which is enough to send one packet an hour for a year!  You can use whatever LNS you have."]}),"\n",(0,a.jsxs)(t.p,{children:["In your MetSci Console, go to your Application, then select the ",(0,a.jsx)(t.code,{children:"Integrations"})," tab and hit the ",(0,a.jsx)(t.code,{children:"+"})," on the HTTP box."]}),"\n",(0,a.jsx)("div",{style:{display:"flex",justifyContent:"center",margin:"20px auto"},children:(0,a.jsx)("img",{src:"/img/blog/2025-06-29-how-do-you-keep-your-data/console-application-integration-http.png",alt:"MeteoScientific Console showing application integrations with HTTP integration option",style:{maxWidth:"800px",width:"100%",borderRadius:"8px",border:"4px solid var(--metsci-primary)",boxShadow:"0 4px 12px rgba(217, 74, 24, 0.15)"}})}),"\n",(0,a.jsxs)(t.p,{children:["Leave the ",(0,a.jsx)(t.code,{children:"Payload encoding"})," as ",(0,a.jsx)(t.code,{children:"JSON"}),", paste in the custom Route you set up (for me it was ",(0,a.jsx)(t.code,{children:"bike-tracker.meteoscientific.com/api/track"}),", then hit  ",(0,a.jsx)(t.code,{children:"+ Add header"}),"."]}),"\n",(0,a.jsxs)(t.p,{children:["For the Key put ",(0,a.jsx)(t.code,{children:"Authorization"}),", and for the Value put ",(0,a.jsx)(t.code,{children:"Bearer your-long-Cloudflare-secret"}),"."]}),"\n",(0,a.jsxs)(t.p,{children:["Don\u2019t forget the ",(0,a.jsx)(t.code,{children:"Bearer"})," in front!"]}),"\n",(0,a.jsx)("div",{style:{display:"flex",justifyContent:"center",margin:"20px auto"},children:(0,a.jsx)("img",{src:"/img/blog/2025-06-29-how-do-you-keep-your-data/add-http-integration-route-and-header.png",alt:"HTTP integration setup showing route configuration and authorization header setup",style:{maxWidth:"800px",width:"100%",borderRadius:"8px",border:"4px solid var(--metsci-primary)",boxShadow:"0 4px 12px rgba(217, 74, 24, 0.15)"}})}),"\n",(0,a.jsx)(t.p,{children:"Hit Submit and you\u2019re done!"}),"\n",(0,a.jsx)(t.h2,{id:"confirm-packets",children:"Confirm Packets"}),"\n",(0,a.jsx)(t.p,{children:"Fire off a few packets from your device and then watch them come in over on the Cloudflare D1."}),"\n",(0,a.jsx)(t.p,{children:"To see that, from the Cloudflare main menu:"}),"\n",(0,a.jsxs)(t.p,{children:[(0,a.jsx)(t.code,{children:"Storage & Databases"})," \u2014> ",(0,a.jsx)(t.code,{children:"D1 SQL Database"})," \u2014> choose your database"]}),"\n",(0,a.jsx)(t.p,{children:"then hit the Explore Data blue button in the top right."}),"\n",(0,a.jsx)("div",{style:{display:"flex",justifyContent:"center",margin:"20px auto"},children:(0,a.jsx)("img",{src:"/img/blog/2025-06-29-how-do-you-keep-your-data/explore-data.png",alt:"Cloudflare D1 database interface showing the Explore Data button for viewing stored data",style:{maxWidth:"800px",width:"100%",borderRadius:"8px",border:"4px solid var(--metsci-primary)",boxShadow:"0 4px 12px rgba(217, 74, 24, 0.15)"}})}),"\n",(0,a.jsx)(t.p,{children:"You\u2019ll see the first few rows of data in there (depending on how often your device is firing).  Now you have a database storing your data, congrats!"}),"\n",(0,a.jsx)("div",{style:{display:"flex",justifyContent:"center",margin:"20px auto"},children:(0,a.jsx)("img",{src:"/img/blog/2025-06-29-how-do-you-keep-your-data/successful-uplinks.png",alt:"D1 database showing successful data uplinks with device tracking information stored in table rows",style:{maxWidth:"800px",width:"100%",borderRadius:"8px",border:"4px solid var(--metsci-primary)",boxShadow:"0 4px 12px rgba(217, 74, 24, 0.15)"}})}),"\n",(0,a.jsx)(t.p,{children:"We'll talk about what to DO with your stored data in future tutorials.  For now, well done on diving a little further down the rabbit hole of geekery and taking control of your data with LoRaWAN devices."}),"\n",(0,a.jsxs)(t.p,{children:["If you like this kind of dive into LoRaWAN I've got a set of ",(0,a.jsx)(t.a,{href:"/docs/tutorial-basics/LoRaWAN-Big-Picture",children:"Tutorials"})," for you as well as a ",(0,a.jsx)(t.a,{href:"https://pod.metsci.show",children:"podcast"}),".  Enjoy the learning, and pass it on wherever you can."]}),"\n",(0,a.jsx)(t.p,{children:"Rock 'n roll!"}),"\n",(0,a.jsx)(t.admonition,{title:"Author",type:"info",children:(0,a.jsxs)(t.p,{children:[(0,a.jsx)(t.strong,{children:"Nik Hawks"})," is incurably curious at ",(0,a.jsx)(t.a,{href:"https://meteoscientific.com/",children:"MeteoScientific"}),". He writes to educate and delight people considering IoT, and to inspire other IoT nerds to build and deploy their own projects into the world. He runs ",(0,a.jsx)(t.a,{href:"https://pod.metsci.show",children:"The Business of LoRaWAN podcast"})," discussing all things LoRaWAN and is psyched to hear about what you're building, whether it's a one sensor playground or a million sensor rollout."]})})]})}function c(e={}){const{wrapper:t}={...(0,n.R)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(h,{...e})}):h(e)}}}]);